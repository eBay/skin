@import "../../mixins/utility/utility-mixins.less";

.menu-button,
.fake-menu-button {
    line-height: normal;
    position: relative;
}

.menu-button__menu,
.fake-menu-button__menu {
    .dropdown-base();

    // In ebayui there is a bug where if tabindex=-1 outside the menu button
    // Any clicks inside will trigger on the outher tabindex=-1. In order to fix it
    // We added a tabindex=-1 on the popup menu root (on root so you can scroll)
    // This forces a focus ring, so this focus ring is removed from the root.
    outline: 0;
}

span.menu-button__button,
span.fake-menu-button__button {
    display: inline-block;
    vertical-align: bottom;
}

.fake-menu-button__menu {
    list-style-type: none;
    margin: 0;
    max-height: calc(50vh - 40px);
    overflow-y: auto;
    padding: 0;
}

div.menu-button__item[role^="menuitem"] {
    .menu-menuitem-base();
    .dropdown-item-border-radius();

    cursor: default; // needed to override text cursor
}

.menu-button__item svg.icon,
.fake-menu-button__item svg.icon {
    .menu-menuitem-status();
}

.menu-button__item svg.icon:last-child,
.fake-menu-button__item svg.icon:last-child,
.menu-button__item .badge {
    margin-left: 8px;
}

// anchor tag specific
a.fake-menu-button__item {
    .customColorProperty(menu-anchor-color);

    text-decoration: none;

    &:focus {
        text-decoration: underline;
    }

    &:hover,
    &:visited {
        .customColorProperty(menu-anchor-color);
    }
}

// button tag specific
button.fake-menu-button__item {
    .customBackgroundColorProperty(menu-button-background-color);
    .customColorProperty(menu-button-foreground-color);

    font-family: inherit;
    font-size: 1em;
    text-align: left;
}

button.fake-menu-button__item:active svg.icon,
a.fake-menu-button__item:active svg.icon {
    .customColorProperty(menu-menuitem-active-status-color);
}

a.fake-menu-button__item:not([href]),
button.fake-menu-button__item[disabled],
div.menu-button__item[role^="menuitem"][aria-disabled="true"] {
    color: @menu-menuitem-disabled-foreground-color;
}

a.fake-menu-button__item[aria-current="page"] svg.icon,
button.fake-menu-button__item[aria-current="page"] svg.icon {
    opacity: 1;
}

div.menu-button__item[role^="menuitem"]:active svg.icon {
    .customColorProperty(menu-menuitem-active-status-color);
}

div.menu-button__item[role^="menuitem"][aria-checked="true"] svg.icon {
    opacity: 1;
}

.fake-menu-button__menu a.fake-menu-button__item,
.fake-menu-button__menu button.fake-menu-button__item {
    .menu-menuitem-base();
}

.fake-menu-button__menu > li:first-child a.fake-menu-button__item {
    .customBorderTopLeftRadiusProperty(dropdown-border-radius);
    .customBorderTopRightRadiusProperty(dropdown-border-radius);
}

.fake-menu-button__menu > li:last-child a.fake-menu-button__item {
    .customBorderBottomLeftRadiusProperty(dropdown-border-radius);
    .customBorderBottomRightRadiusProperty(dropdown-border-radius);
}

.menu-button__menu--fix-width,
.fake-menu-button__menu--fix-width {
    width: 100%;

    span {
        .truncate();

        width: 100%;
    }
}

a.fake-menu-button__item span,
button.fake-menu-button__item span,
div.menu-button__item[role^="menuitem"] span {
    flex: 1 0 auto;
    white-space: nowrap;
}

a.fake-menu-button__item span.badge,
button.fake-menu-button__item span.badge,
div.menu-button__item[role^="menuitem"] span.badge {
    flex: initial;
}

.menu-button__menu--scroll {
    overflow-y: scroll;
}

.menu-button__menu--reverse,
.fake-menu-button__menu--reverse {
    right: 0;
}

.menu-button button.expand-btn--borderless,
.fake-menu-button button.expand-btn--borderless {
    background-color: transparent;
    border-color: transparent;
    padding-left: 0;
    vertical-align: initial;

    &:focus {
        outline: none;
        text-decoration: underline;
    }
}

.menu-button__button[aria-expanded="true"] ~ .menu-button__menu,
.fake-menu-button__button[aria-expanded="true"] ~ .fake-menu-button__menu,
.menu-button .expand-btn[aria-expanded="true"] ~ .menu-button__menu,
.fake-menu-button .expand-btn[aria-expanded="true"] ~ .fake-menu-button__menu {
    display: block;
}

.menu-button__button ~ .menu-button__menu--static,
.fake-menu-button__button ~ .fake-menu-button__menu--static,
.expand-btn ~ .menu-button__menu--static,
.expand_btn ~ .fake-menu-button__menu--static {
    position: static;
}

.menu button.expand-btn--borderless[aria-expanded="true"] ~ .menu-button__menu,
.fake-menu button.expand-btn--borderless[aria-expanded="true"] ~ .menu-button__menu {
    top: 41px; // button height plus one px, to meet design guidelines
}

div.menu-button__option--active[role="option"] {
    font-weight: @menu-button-menuitem-active-font-weight;
}

hr.menu-button__separator {
    .customBorderColorProperty(menu-separator-color);

    border-style: solid;
    border-width: 1px;
    margin: 0;
}

// https://developer.paciellogroup.com/blog/2018/03/focus-visible-and-backwards-compatibility/
div.menu-button__item[role^="menuitem"]:focus:not(:focus-visible) {
    outline: none;
}

@media (prefers-color-scheme: dark) {
    .skin-experiment-dark-mode {
        .menu-button,
        .fake-menu-button {
            --dropdown-background-color: @color-black-dark-mode;
            --menu-menuitem-border-color: @color-black-dark-mode;
            --menu-menuitem-foreground-color: @color-text-default-dark-mode;
            --menu-menuitem-hover-foreground-color: @color-text-default;
        }
    }
}
